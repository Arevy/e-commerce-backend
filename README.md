# E-commerce Backend Setup

This README provides step-by-step instructions to set up the database and test the functionality of the e-commerce backend project from scratch.

---

## Technology Stack Overview

### 1. **Programming Language**

- **TypeScript**: A strongly typed superset of JavaScript that compiles to plain JavaScript. It ensures type safety, improves code quality, and helps catch errors during development.

### 2. **Runtime**

- **Node.js**: JavaScript runtime used for building scalable, high-performance server-side applications.

### 3. **Web Framework**

- **Express.js**: A lightweight and flexible web application framework for Node.js, used to build RESTful APIs and GraphQL endpoints.

### 4. **GraphQL**

- **GraphQL**: A query language for APIs that allows clients to request only the data they need.
  - GraphQL enables flexible and efficient communication between the backend and frontend.
  - Integrated with the `express-graphql` middleware for seamless operation with the Express framework.

### 5. **Database**

- **Oracle Database**: A powerful relational database management system used to store and manage application data.
  - **Instance**: `ORCLCDB` running on `localhost`.
  - **Key Features**:
    - High scalability and reliability.
    - ACID compliance for secure transactions.
    - Advanced indexing and query optimization.

### 6. **Authentication**

- **JWT (JSON Web Tokens)**: A secure method for implementing authentication and authorization.
  - Tokens are signed with a secret key and include user-specific claims.

---

## Oracle Database Configuration

### Why Oracle Database?

- **Reliability**: Proven enterprise-grade database management.
- **Performance**: Optimized for complex queries and high transaction loads.
- **Flexibility**: Supports advanced SQL features, transactions, and stored procedures.

### Oracle Database Instance

- The backend connects to an Oracle Database instance with the following details:
  - **Service Name**: `ORCLCDB`
  - **Host**: `localhost`
  - **Port**: `1521`

### Steps to Set Up Oracle Database

1. **Install Oracle Database**:
   Download and install Oracle Database on your machine following [official documentation](https://www.oracle.com/database/technologies/).

2. **Start the Oracle Database Instance**:
   Ensure the database instance is running:
   ```bash
   sqlplus / as sysdba
   STARTUP;
   ```

---

## Prerequisites

- **Node.js Version**: `18.18.0`
- **Package Manager**: Yarn
- **Oracle Database**: Running and accessible

---

## Environment Variables (`.env`)

Create a `.env` file in the root of your project with the following content:

```plaintext
# Database Configuration
DB_USER=your_oracle_db_username
DB_PASSWORD=your_oracle_db_password
DB_CONNECT_STRING=localhost:1521/ORCLCDB

# JWT Secret
JWT_SECRET=your_secret_key
```

# JWT Secret

JWT_SECRET=your_secret_key

---

## Database Setup

### **Create Database Tables**

Run the following SQL commands to create the required tables.

#### Create `CATEGORIES` Table

```sql
CREATE TABLE CATEGORIES (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME VARCHAR2(255) NOT NULL UNIQUE,
  DESCRIPTION VARCHAR2(500)
);
```

#### Create `PRODUCTS` Table

```sql
CREATE TABLE PRODUCTS (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME VARCHAR2(255) NOT NULL,
  PRICE NUMBER(10, 2) NOT NULL,
  DESCRIPTION VARCHAR2(500),
  CATEGORY_ID NUMBER,
  CONSTRAINT FK_PRODUCTS_CATEGORIES FOREIGN KEY (CATEGORY_ID)
  REFERENCES CATEGORIES (ID)
);
```

#### Populate CATEGORIES Table

Add initial categories to the database.

```sql
INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Electronics', 'Electronic devices and gadgets');
INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Books', 'Wide variety of books');
INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Clothing', 'Apparel and accessories');
COMMIT;
```

#### Populate PRODUCTS Table

Add initial products to the database and associate them with categories.

```sql
INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION, CATEGORY_ID)
VALUES ('Laptop', 999.99, 'High-performance laptop', 1);

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION, CATEGORY_ID)
VALUES ('Smartphone', 799.99, 'Latest model with advanced features', 1);

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION, CATEGORY_ID)
VALUES ('Science Fiction Novel', 19.99, 'Explore distant worlds and adventures', 2);

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION, CATEGORY_ID)
VALUES ('T-Shirt', 15.99, 'Comfortable cotton T-shirt', 3);
COMMIT;
```

# GraphQL API Setup

This section includes all GraphQL queries and mutations needed to set up and validate the backend functionality. Comments are included for clarity.

---

## 1. Add a New Category

Use this mutation to add a new category to the database.

```graphql
# Mutation to add a new category
mutation {
  addCategory(name: "Home Appliances", description: "Appliances for home use") {
    id # The unique ID of the category
    name # The name of the category
    description # The description of the category
  }
}
```

## 2. Add a New Product

Use this mutation to add a new product to the database and associate it with an existing category.

**Note:** Ensure the `categoryId` provided exists in the database. If the `categoryId` is invalid, the mutation will return an error.

```graphql
# Mutation to add a new product
mutation {
  addProduct(
    name: "Washing Machine" # The name of the product
    price: 499.99 # The price of the product
    description: "Efficient front-load washing machine" # Product description
    categoryId: 1 # The ID of the category to associate with this product
  ) {
    id # The unique ID of the product
    name # The name of the product
    price # The price of the product
    description # The description of the product
    category {
      # The associated category details
      id # The ID of the associated category
      name # The name of the associated category
    }
  }
}
```

## 3. Get All Categories with Products

Use this query to retrieve all categories and the products associated with each category.

```graphql
# Query to fetch all categories with their associated products
query {
  getCategories {
    id # The unique ID of the category
    name # The name of the category
    description # The description of the category
    products {
      # List of products in this category
      id # The unique ID of the product
      name # The name of the product
      price # The price of the product
      description # The description of the product
    }
  }
}
```

## 4. Get All Products with Their Categories

Use this query to retrieve all products and the categories they belong to.

```graphql
# Query to fetch all products with their associated categories
query {
  getProducts {
    id # The unique ID of the product
    name # The name of the product
    price # The price of the product
    description # The description of the product
    category {
      # The associated category details
      id # The ID of the associated category
      name # The name of the associated category
    }
  }
}
```

# Testing GraphQL API with cURL

This section explains how to test the GraphQL API using cURL. This is particularly useful for verifying the API in case of backups or automated scripts.

---

## Verify API Connection

To ensure the server and API are functioning correctly, you can test the connection by sending a request to add a product.

### Test Adding a Product

Run the following cURL command:

```bash
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"mutation { addProduct(name: \"Test\", price: 10.0, description: \"Test desc\") { id name price description }}"}'
```

```bash
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"mutation { addProduct(name: \"Test\", price: 10.0, description: \"Test desc\", categoryId: 1) { id name price description category { id name } }}"}'
```

```bash
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"query { getProducts { id name price description category { id name } }}"}'
```
