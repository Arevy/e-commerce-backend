CREATE TABLE PRODUCTS (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME VARCHAR2(255) NOT NULL,
  PRICE NUMBER(10, 2) NOT NULL,
  DESCRIPTION VARCHAR2(500)
);

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION)
VALUES ('Laptop', 999.99, 'High-performance laptop');

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION)
VALUES ('Smartphone', 499.99, 'Latest generation smartphone');

COMMIT


SELECT * FROM PRODUCTS;

INSERT INTO PRODUCTS (NAME, PRICE, DESCRIPTION)
VALUES ('Test Product', 100.00, 'Description for Test Product');


CREATE TABLE CATEGORIES (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME VARCHAR2(255) NOT NULL UNIQUE,
  DESCRIPTION VARCHAR2(500)
);

ALTER TABLE PRODUCTS ADD CATEGORY_ID NUMBER;

ALTER TABLE PRODUCTS ADD CONSTRAINT FK_PRODUCTS_CATEGORIES FOREIGN KEY (CATEGORY_ID)
REFERENCES CATEGORIES (ID);


CREATE TABLE USERS (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  EMAIL VARCHAR2(255) NOT NULL UNIQUE,
  PASSWORD VARCHAR2(255) NOT NULL,
  NAME VARCHAR2(255)
);


SELECT *  FROM categories;

UPDATE PRODUCTS SET CATEGORY_ID = 1 WHERE CATEGORY_ID IS NULL;
COMMIT;

INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Electronics', 'Electronic devices and gadgets');
INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Books', 'Wide variety of books');
INSERT INTO CATEGORIES (NAME, DESCRIPTION) VALUES ('Clothing', 'Apparel and accessories');
COMMIT;

CREATE TABLE ORDERS (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USER_ID NUMBER NOT NULL,
  TOTAL NUMBER(10, 2) NOT NULL,
  STATUS VARCHAR2(20) DEFAULT 'PENDING',
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT FK_ORDERS_USERS FOREIGN KEY (USER_ID) REFERENCES USERS (ID)
);

CREATE TABLE ORDER_PRODUCTS (
  ORDER_ID NUMBER,
  PRODUCT_ID NUMBER,
  QUANTITY NUMBER NOT NULL,
  PRICE NUMBER(10, 2) NOT NULL,
  PRIMARY KEY (ORDER_ID, PRODUCT_ID),
  CONSTRAINT FK_ORDER_PRODUCTS_ORDERS FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ID),
  CONSTRAINT FK_ORDER_PRODUCTS_PRODUCTS FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS (ID)
);


SELECT * FROM USERS WHERE ID = 1;

INSERT INTO USERS (EMAIL, PASSWORD, NAME)
VALUES ('testuser@example.com', 'password123', 'Test User');
COMMIT;


ALTER TABLE CATEGORIES DROP CONSTRAINT SYS_C007471;

SELECT * FROM USERS;

DECLARE
  new_id NUMBER;
BEGIN
  INSERT INTO USERS (EMAIL, PASSWORD, NAME)
  VALUES ('manualtest@example.com', 'testpassword', 'Manual Test')
  RETURNING ID INTO new_id;
  DBMS_OUTPUT.PUT_LINE('New User ID: ' || new_id);
END;
/